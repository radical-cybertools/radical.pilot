
# this is the default agent config which is used if no other config is
# specified for an agent.  It contains the minimal set of settings required for
# a functional pilot agent, without any component redundency.

# we should call this `pilot_config` instead of `agent_config`, since it 
# *contains* the agent layout for a pilot.

{
    # `scheduler`          : algorithm to place units on the agent resources
    # `spawner`            : method to spawn compute unit processes
    # `task_launch_method` : method to reach compute nodes (for non-mpi tasks)
    # `mpi_launch_method`  : method to reach compute nodes (for mpi tasks)
    "mode" {
        "default"                  : "ssh", 
        "ssh" : {
            "scheduler"            : "CONTINUOUS",
            "spawner"              : "POPEN",
            "task_launch_method"   : "SSH",
            "mpi_launch_method"    : "MPIRUN_RSH"
        }, 
        "aprun" : {
            "scheduler"            : "CONTINUOUS",
            "spawner"              : "POPEN",
            "task_launch_method"   : "APRUN",
            "mpi_launch_method"    : "APRUN"
        }, 
        "orte" : {
            "scheduler"            : "CONTINUOUS",
            "spawner"              : "POPEN",
            "task_launch_method"   : "ORTE",
            "mpi_launch_method"    : "ORTE"
        }, 
        "ortelib" : {
            "scheduler"            : "CONTINUOUS",
            "spawner"              : "ORTELIB",
            "task_launch_method"   : "ORTELIB",
            "mpi_launch_method"    : "ORTELIB"
        }
    },
        
    # `max_io_loglength`     : max number of cu out/err chars to push to db
    # `bulk_collection_size` : max number of updates to put into a db bulk
    # `bulk_collection_time` : max seconds to collect db notification bulks
    # `db_poll_sleeptime`    : seconds to sleep between database polls
    "tuning" : {
        "default"                  : "bulked", 
        "bulked" : {
            "max_io_loglength"     : 1024,
            "bulk_collection_size" :  100,
            "bulk_collection_time" :  1.0,
            "db_poll_sleeptime"    :  1.0
        }
    },

    # `shared`: if true, use agent node also for CUs (not yet implemented)
    # `target`: sub-agents hosting additional component instances can run on the
    #           same node ('local') or on other nodes ('node') as `agent_0`. 
    #           agent_0 must always have target 'local'.
    # The `UpdateWorker` component must live in agent_0, as only that agent is
    # known to have connectivity toward the DB.
    # All bridges must live in agent_0.
    "config" : {
        "default" : "beowulf", 
        "beowulf" : {
            "agent_0" : {
                "target"     : "local",
                "shared"     : false,
                "components" : {
                    "UpdateWorker"                : {"count" : 1},
                    "AgentStagingInputComponent"  : {"count" : 1},
                    "AgentSchedulingComponent"    : {"count" : 1},
                    "AgentExecutingComponent"     : {"count" : 1},
                    "AgentStagingOutputComponent" : {"count" : 1}
                },
                "bridges" : {
                    "agent_staging_input_queue"   : {"log_level" : "debug",
                                                     "stall_hwm" : 1,
                                                     "bulk_size" : 0},
                    "agent_scheduling_queue"      : {"log_level" : "debug",
                                                     "stall_hwm" : 1,
                                                     "bulk_size" : 0},
                    "agent_executing_queue"       : {"log_level" : "debug",
                                                     "stall_hwm" : 1,
                                                     "bulk_size" : 0},
                    "agent_staging_output_queue"  : {"log_level" : "debug",
                                                     "stall_hwm" : 1,
                                                     "bulk_size" : 0},
                                                  
                    "agent_unschedule_pubsub"     : {"log_level" : "debug",
                                                     "stall_hwm" : 1,
                                                     "bulk_size" : 0},
                    "agent_schedule_pubsub"       : {"log_level" : "debug",
                                                     "stall_hwm" : 1,
                                                     "bulk_size" : 0},
                    "log_pubsub"                  : {"log_level" : "debug",
                                                     "stall_hwm" : 1,
                                                     "bulk_size" : 0},
                    "state_pubsub"                : {"log_level" : "debug",
                                                     "stall_hwm" : 1,
                                                     "bulk_size" : 0},
                    "control_pubsub"              : {"log_level" : "debug",
                                                     "stall_hwm" : 1,
                                                     "bulk_size" : 0}
                }
            }
        },
        "cray" : {
            "agent_0" : {
                "target"     : "local",
                "shared"     : false,
                "components" : {
                    "UpdateWorker" : {"count" : 1},
                },
                "agent_1": {
                    "target"    : "node",
                    "shared"    : false,
                    "components": {
                        "AgentStagingInputComponent"  : {"count" : 1},
                        "AgentSchedulingComponent"    : {"count" : 1},
                        "AgentExecutingComponent"     : {"count" : 1},
                        "AgentStagingOutputComponent" : {"count" : 1}
                    }
                }
                "bridges" : {
                    "agent_staging_input_queue"   : {"log_level" : "debug",
                                                     "stall_hwm" : 1,
                                                     "bulk_size" : 0},
                    "agent_scheduling_queue"      : {"log_level" : "debug",
                                                     "stall_hwm" : 1,
                                                     "bulk_size" : 0},
                    "agent_executing_queue"       : {"log_level" : "debug",
                                                     "stall_hwm" : 1,
                                                     "bulk_size" : 0},
                    "agent_staging_output_queue"  : {"log_level" : "debug",
                                                     "stall_hwm" : 1,
                                                     "bulk_size" : 0},
                                                  
                    "agent_unschedule_pubsub"     : {"log_level" : "debug",
                                                     "stall_hwm" : 1,
                                                     "bulk_size" : 0},
                    "agent_schedule_pubsub"       : {"log_level" : "debug",
                                                     "stall_hwm" : 1,
                                                     "bulk_size" : 0},
                    "log_pubsub"                  : {"log_level" : "debug",
                                                     "stall_hwm" : 1,
                                                     "bulk_size" : 0},
                    "state_pubsub"                : {"log_level" : "debug",
                                                     "stall_hwm" : 1,
                                                     "bulk_size" : 0},
                    "control_pubsub"              : {"log_level" : "debug",
                                                     "stall_hwm" : 1,
                                                     "bulk_size" : 0}
                }
            }
        }
    }
}

